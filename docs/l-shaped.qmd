---
title: "L-shapred Benders Decomposition"
author: "Edward Xu"
jupyter: julia-1.8
---

## Two-stage stochastic programming problem

| Symbol        | Definition                                         | Note |
|---------------|----------------------------------------------------|------|
| $\mathcal{S}$ | scenarios                                          |      |
| $\mathbf{Y}$  | possible values of the vector of integer variables |      |

: Definitions and notes of symbols.

The standard form of a two-stage stochastic programming problem (without integer variable in the second stage) is:

$$
\begin{align}
    \min \quad & \mathbf{f}^\top \mathbf{y} + 
        \sum_{s \in \mathcal{S}} p_s \mathbf{c}_s^\top \mathbf{x}_s \\
    \text{s.t.} \quad & \mathbf{T}_s \mathbf{y} 
        + \mathbf{W}_s \mathbf{x}_s 
        \geq \mathbf{h}_s 
        \quad \forall s \in \mathcal{S} \\ 
    & \mathbf{y} \in \mathbf{Y} \\ 
    & \mathbf{x}_s \geq 0 \quad \forall s \in \mathcal{S}
\end{align}
$$

where $\mathbf{y}$ represents all the integer variables.

It can be formulated to the deterministic equivalent problem (DEP) that highlights the nature stochasticity:

$$
\begin{align}
    \min \quad & \mathbf{f}^\top \mathbf{y} + 
        \mathscr{Q}(x) \\
    \text{s.t.} \quad & \mathbf{y} \in \mathbf{Y}
\end{align}
$$

where $\mathscr{Q}(\overline{\mathbf{y}})$ represents the costs in the second stage, because of the first stage decision, $\overline{\mathbf{y}}$:

$$
\mathscr{Q}(\overline{\mathbf{y}}) = \mathrm{E}_{s \in \mathcal{S}} 
    \left[ \min_{x_s} \left\{ c_s^\top x_s | \mathbf{T}_s \overline{\mathbf{y}} 
        + \mathbf{W}_s \mathbf{x}_s \geq \mathbf{h}_s \right\} \right]
$$

$\mathscr{Q}(\overline{\mathbf{y}})$ can be easily calcualted in the corresponding deterministic formulation, but it will be obtained iteratively in the L-shaped decomposition, together with iteratively added optimality cuts and feasibility cuts.

## L-shaped decomposition

### Main problem

The main problem is:

$$
\begin{align}
    \min \quad& \mathbf{f}^\top \mathbf{y} + \theta \\
    \text{s.t.} \quad & \mathbf{y} \in \mathbf{Y} \\
    & {\overline{\mathbf{u}}_j^r}^\top (\mathbf{h}_s - \mathbf{T}_s \mathbf{y}) 
        \leq 0 \quad \forall j \quad \text{(feasibility cuts)} \\ 
    & {\overline{\mathbf{u}}_i^p}^\top (\mathbf{h}_s - \mathbf{T}_s \mathbf{y}) 
        \leq \theta \quad \forall i \quad \text{(optimality cuts)}
\end{align}
$$

### Sub problem

The sub-problem of scenario $s$ is:

$$
\begin{align}
    \min \quad & w = \mathbf{c}_s^\top \mathbf{x}_s \\
    \text{s.t.} \quad & 
    \mathbf{W}_s \mathbf{x}_s \geq 
        \mathbf{h}_s - \mathbf{T}_s \overline{\mathbf{y}} \\
    & \mathbf{x}_s \geq 0
\end{align}
$$

of which the dual problem is:

$$
\begin{align}
    \max \quad & \left(\mathbf{h}_s - \mathbf{T}_s \overline{\mathbf{y}} \right)^\top \mathbf{u}_s \\
    \text{s.t.} \quad & \mathbf{W}_s^\top \mathbf{u}_s \leq \mathbf{c}^T \\
    & \mathbf{u}_s \geq 0
\end{align}
$$

The aggregation of $\overline{\mathbf{u}}$ and $\text{obj}_{\text{sub}}$ from all scenarios are:

$$
\begin{align}
    \overline{\mathbf{u}} &= \sum_{s \in \Omega} p_s \mathbf{u}_s \\
    \overline{w} &= \sum_{s \in \Omega} p_s w_s \\
\end{align}
$$

### Feasibility cut

extreme ray

### Optimality cut

extrame point

## Compare deterministic formulation with stochastic one

## Risk aversion